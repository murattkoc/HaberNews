<html>
<head>
<title>UPGRADE.md</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
UPGRADE.md</font>
</center></td></tr></table>
<pre><span class="s0">Symfony Standard Edition Upgrade</span>
<span class="s2">================================</span>

<span class="s0">From Symfony 2.0 to Symfony 2.1</span>
<span class="s2">-------------------------------</span>

<span class="s2">### </span><span class="s0">Project Dependencies</span>

<span class="s0">As of Symfony 2.1, project dependencies are managed by</span>
<span class="s1">[</span><span class="s0">Composer</span><span class="s1">](http://getcomposer.org/):</span>

<span class="s2">* </span><span class="s0">The </span><span class="s3">`</span><span class="s0">bin/vendors</span><span class="s3">` </span><span class="s0">script can be removed as </span><span class="s3">`</span><span class="s0">composer.phar</span><span class="s3">` </span><span class="s0">does all the work</span>
  <span class="s0">now </span><span class="s1">(</span><span class="s0">it is recommended to install it globally on your machine</span><span class="s1">)</span><span class="s0">.</span>

<span class="s2">* </span><span class="s0">The </span><span class="s3">`</span><span class="s0">deps</span><span class="s3">` </span><span class="s0">file need to be replaced with the </span><span class="s3">`</span><span class="s0">composer.json</span><span class="s3">` </span><span class="s0">one.</span>

<span class="s2">* </span><span class="s0">The </span><span class="s3">`</span><span class="s0">composer.lock</span><span class="s3">` </span><span class="s0">is the equivalent of the generated </span><span class="s3">`</span><span class="s0">deps.lock</span><span class="s3">` </span><span class="s0">file and</span>
  <span class="s0">it is automatically generated by Composer.</span>

<span class="s0">Download the default</span>
<span class="s1">[</span><span class="s3">`</span><span class="s0">composer.json</span><span class="s3">`</span><span class="s1">](https://raw.github.com/symfony/symfony-standard/2.1/composer.json)</span>
<span class="s0">and</span>
<span class="s1">[</span><span class="s3">`</span><span class="s0">composer.lock</span><span class="s3">`</span><span class="s1">](https://raw.github.com/symfony/symfony-standard/2.1/composer.lock)</span>
<span class="s0">files for Symfony 2.1 and put them into the main directory of your project. If</span>
<span class="s0">you have customized your </span><span class="s3">`</span><span class="s0">deps</span><span class="s3">` </span><span class="s0">file, move the added dependencies to the</span>
<span class="s3">`</span><span class="s0">composer.json</span><span class="s3">` </span><span class="s0">file </span><span class="s1">(</span><span class="s0">many bundles and PHP libraries are already available as</span>
<span class="s0">Composer packages -- search for them on </span><span class="s1">[</span><span class="s0">Packagist</span><span class="s1">](http://packagist.org/))</span><span class="s0">.</span>

<span class="s0">Remove your current </span><span class="s3">`</span><span class="s0">vendor</span><span class="s3">` </span><span class="s0">directory.</span>

<span class="s0">Finally, run Composer</span><span class="s1">:</span>

    <span class="s3">$ composer.phar install</span>

<span class="s0">Note</span><span class="s1">: </span><span class="s0">You must complete the upgrade steps below so composer can successfully generate the autoload files.</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/autoload.php</span><span class="s3">`</span>

<span class="s0">The default </span><span class="s3">`</span><span class="s0">autoload.php</span><span class="s3">` </span><span class="s0">reads as follows </span><span class="s1">(</span><span class="s0">it has been simplified a lot as</span>
<span class="s0">autoloading for libraries and bundles declared in your </span><span class="s3">`</span><span class="s0">composer.json</span><span class="s3">` </span><span class="s0">file is</span>
<span class="s0">automatically managed by the Composer autoloader</span><span class="s1">):</span>

    <span class="s3">&lt;?php</span>

    <span class="s3">use Doctrine\Common\Annotations\AnnotationRegistry;</span>

    <span class="s3">$loader = include __DIR__.'/../vendor/autoload.php';</span>

    <span class="s3">// intl</span>
    <span class="s3">if (!function_exists('intl_get_error_code')) {</span>
        <span class="s3">require_once __DIR__.'/../vendor/symfony/symfony/src/Symfony/Component/Locale/Resources/stubs/functions.php';</span>

        <span class="s3">$loader-&gt;add('', __DIR__.'/../vendor/symfony/symfony/src/Symfony/Component/Locale/Resources/stubs');</span>
    <span class="s3">}</span>

    <span class="s3">AnnotationRegistry::registerLoader(array($loader, 'loadClass'));</span>

    <span class="s3">return $loader;</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/config.yml</span><span class="s3">`</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">framework.charset</span><span class="s3">` </span><span class="s0">setting must be removed. If you are not using </span><span class="s3">`</span><span class="s0">UTF-8</span><span class="s3">`</span>
<span class="s0">for your application, override the </span><span class="s3">`</span><span class="s0">getCharset</span><span class="s1">()</span><span class="s3">` </span><span class="s0">method in your </span><span class="s3">`</span><span class="s0">AppKernel</span><span class="s3">`</span>
<span class="s0">class instead</span><span class="s1">:</span>

    <span class="s3">class AppKernel extends Kernel</span>
    <span class="s3">{</span>
        <span class="s3">public function getCharset()</span>
        <span class="s3">{</span>
            <span class="s3">return 'ISO-8859-1';</span>
        <span class="s3">}</span>

        <span class="s3">// ...</span>
    <span class="s3">}</span>

<span class="s0">You might want to add the new </span><span class="s3">`</span><span class="s0">strict_requirements</span><span class="s3">` </span><span class="s0">parameter to</span>
<span class="s3">`</span><span class="s0">framework.router</span><span class="s3">` </span><span class="s1">(</span><span class="s0">it avoids fatal errors in the production environment when</span>
<span class="s0">a link cannot be generated</span><span class="s1">):</span>

    <span class="s3">framework:</span>
        <span class="s3">router:</span>
            <span class="s3">strict_requirements: &quot;%kernel.debug%&quot;</span>

<span class="s0">You can even disable the requirements check on production with </span><span class="s3">`</span><span class="s0">null</span><span class="s3">` </span><span class="s0">as you should</span>
<span class="s0">know that the parameters for URL generation always pass the requirements, e.g. by</span>
<span class="s0">validating them beforehand. This additionally enhances performance. See</span>
<span class="s1">[</span><span class="s0">config_prod.yml</span><span class="s1">](https://github.com/symfony/symfony-standard/blob/master/app/config/config_prod.yml)</span><span class="s0">.</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">default_locale</span><span class="s3">` </span><span class="s0">parameter is now a setting of the main </span><span class="s3">`</span><span class="s0">framework</span><span class="s3">`</span>
<span class="s0">configuration </span><span class="s1">(</span><span class="s0">it was under the </span><span class="s3">`</span><span class="s0">framework.session</span><span class="s3">` </span><span class="s0">in 2.0</span><span class="s1">):</span>

    <span class="s3">framework:</span>
        <span class="s3">default_locale: &quot;%locale%&quot;</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">auto_start</span><span class="s3">` </span><span class="s0">setting under </span><span class="s3">`</span><span class="s0">framework.session</span><span class="s3">` </span><span class="s0">must be removed as it is</span>
<span class="s0">not used anymore </span><span class="s1">(</span><span class="s0">the session is now always started on-demand</span><span class="s1">)</span><span class="s0">. If</span>
<span class="s3">`</span><span class="s0">auto_start</span><span class="s3">` </span><span class="s0">was the only setting under the </span><span class="s3">`</span><span class="s0">framework.session</span><span class="s3">` </span><span class="s0">entry, don't</span>
<span class="s0">remove it entirely, but set its value to </span><span class="s3">`</span><span class="s1">~</span><span class="s3">` </span><span class="s1">(</span><span class="s3">`</span><span class="s1">~</span><span class="s3">` </span><span class="s0">means </span><span class="s3">`</span><span class="s0">null</span><span class="s3">` </span><span class="s0">in YAML</span><span class="s1">)</span>
<span class="s0">instead</span><span class="s1">:</span>

    <span class="s3">framework:</span>
        <span class="s3">session: ~</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">trust_proxy_headers</span><span class="s3">` </span><span class="s0">setting was added in the default configuration file</span>
<span class="s1">(</span><span class="s0">as it should be set to </span><span class="s3">`</span><span class="s0">true</span><span class="s3">` </span><span class="s0">when you install your application behind a</span>
<span class="s0">reverse proxy</span><span class="s1">):</span>

    <span class="s3">framework:</span>
        <span class="s3">trust_proxy_headers: false</span>

<span class="s0">An empty </span><span class="s3">`</span><span class="s0">bundles</span><span class="s3">` </span><span class="s0">entry was added to the </span><span class="s3">`</span><span class="s0">assetic</span><span class="s3">` </span><span class="s0">configuration</span><span class="s1">:</span>

    <span class="s3">assetic:</span>
        <span class="s3">bundles: []</span>

<span class="s0">The default </span><span class="s3">`</span><span class="s0">swiftmailer</span><span class="s3">` </span><span class="s0">configuration now has the </span><span class="s3">`</span><span class="s0">spool</span><span class="s3">` </span><span class="s0">setting configured</span>
<span class="s0">to the </span><span class="s3">`</span><span class="s0">memory</span><span class="s3">` </span><span class="s0">type to defer email sending after the response is sent to the</span>
<span class="s0">user </span><span class="s1">(</span><span class="s0">recommended for better end-user performance</span><span class="s1">):</span>

    <span class="s3">swiftmailer:</span>
        <span class="s3">spool: { type: memory }</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">jms_security_extra</span><span class="s3">` </span><span class="s0">configuration was moved to the </span><span class="s3">`</span><span class="s0">security.yml</span><span class="s3">`</span>
<span class="s0">configuration file.</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/config_dev.yml</span><span class="s3">`</span>

<span class="s0">An example of how to send all emails to a unique address was added</span><span class="s1">:</span>

    <span class="s3">#swiftmailer:</span>
    <span class="s3">#    delivery_address: me@example.com</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/config_test.yml</span><span class="s3">`</span>

<span class="s0">The </span><span class="s3">`</span><span class="s0">storage_id</span><span class="s3">` </span><span class="s0">setting must be changed to </span><span class="s3">`</span><span class="s0">session.storage.mock_file</span><span class="s3">`</span><span class="s1">:</span>

    <span class="s3">framework:</span>
        <span class="s3">session:</span>
            <span class="s3">storage_id: session.storage.mock_file</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/parameters.ini</span><span class="s3">`</span>

<span class="s0">The file has been converted to a YAML file which reads as follows</span><span class="s1">:</span>

    <span class="s3">parameters:</span>
        <span class="s3">database_driver:   pdo_mysql</span>
        <span class="s3">database_host:     localhost</span>
        <span class="s3">database_port:     ~</span>
        <span class="s3">database_name:     symfony</span>
        <span class="s3">database_user:     root</span>
        <span class="s3">database_password: ~</span>

        <span class="s3">mailer_transport:  smtp</span>
        <span class="s3">mailer_host:       localhost</span>
        <span class="s3">mailer_user:       ~</span>
        <span class="s3">mailer_password:   ~</span>

        <span class="s3">locale:            en</span>
        <span class="s3">secret:            ThisTokenIsNotSoSecretChangeIt</span>

<span class="s0">Note that if you convert your parameters file to YAML, you must also change</span>
<span class="s0">its reference in </span><span class="s3">`</span><span class="s0">app/config/config.yml</span><span class="s3">`</span><span class="s0">.</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/routing_dev.yml</span><span class="s3">`</span>

<span class="s0">The </span><span class="s3">`</span><span class="s1">_</span><span class="s0">assetic</span><span class="s3">` </span><span class="s0">entry was removed</span><span class="s1">:</span>

    <span class="s3">#_assetic:</span>
    <span class="s3">#    resource: .</span>
    <span class="s3">#    type:     assetic</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/config/security.yml</span><span class="s3">`</span>

<span class="s0">Under </span><span class="s3">`</span><span class="s0">security.access_control</span><span class="s3">`</span><span class="s0">, the default rule for internal routes was changed</span><span class="s1">:</span>

    <span class="s3">security:</span>
        <span class="s3">access_control:</span>
            <span class="s3">#- { path: ^/_internal/secure, roles: IS_AUTHENTICATED_ANONYMOUSLY, ip: 127.0.0.1 }</span>

<span class="s0">Under </span><span class="s3">`</span><span class="s0">security.providers</span><span class="s3">`</span><span class="s0">, the </span><span class="s3">`</span><span class="s0">in_memory</span><span class="s3">` </span><span class="s0">example was updated to the following</span><span class="s1">:</span>

    <span class="s3">security:</span>
        <span class="s3">providers:</span>
                <span class="s3">in_memory:</span>
                    <span class="s3">memory:</span>
                        <span class="s3">users:</span>
                            <span class="s3">user:  { password: userpass, roles: [ 'ROLE_USER' ] }</span>
                            <span class="s3">admin: { password: adminpass, roles: [ 'ROLE_ADMIN' ] }</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">app/AppKernel.php</span><span class="s3">`</span>

<span class="s0">The following bundles have been added to the list of default registered bundles</span><span class="s1">:</span>

    <span class="s3">new JMS\AopBundle\JMSAopBundle(),</span>
    <span class="s3">new JMS\DiExtraBundle\JMSDiExtraBundle($this),</span>

<span class="s0">You must also rename the DoctrineBundle from</span><span class="s1">:</span>

    <span class="s3">new Symfony\Bundle\DoctrineBundle\DoctrineBundle(),</span>

<span class="s0">to</span><span class="s1">:</span>

    <span class="s3">new Doctrine\Bundle\DoctrineBundle\DoctrineBundle(),</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">web/app.php</span><span class="s3">`</span>

<span class="s0">The default </span><span class="s3">`</span><span class="s0">web/app.php</span><span class="s3">` </span><span class="s0">file now reads as follows</span><span class="s1">:</span>

    <span class="s3">&lt;?php</span>

    <span class="s3">use Symfony\Component\ClassLoader\ApcClassLoader;</span>
    <span class="s3">use Symfony\Component\HttpFoundation\Request;</span>

    <span class="s3">$loader = require_once __DIR__.'/../app/bootstrap.php.cache';</span>

    <span class="s3">// Use APC for autoloading to improve performance.</span>
    <span class="s3">// Change 'sf2' to a unique prefix in order to prevent cache key conflicts</span>
    <span class="s3">// with other applications also using APC.</span>
    <span class="s3">/*</span>
    <span class="s3">$loader = new ApcClassLoader('sf2', $loader);</span>
    <span class="s3">$loader-&gt;register(true);</span>
    <span class="s3">*/</span>

    <span class="s3">require_once __DIR__.'/../app/AppKernel.php';</span>
    <span class="s3">//require_once __DIR__.'/../app/AppCache.php';</span>

    <span class="s3">$kernel = new AppKernel('prod', false);</span>
    <span class="s3">$kernel-&gt;loadClassCache();</span>
    <span class="s3">//$kernel = new AppCache($kernel);</span>
    <span class="s3">$request = Request::createFromGlobals();</span>
    <span class="s3">$response = $kernel-&gt;handle($request);</span>
    <span class="s3">$response-&gt;send();</span>
    <span class="s3">$kernel-&gt;terminate($request, $response);</span>

<span class="s2">### </span><span class="s3">`</span><span class="s0">web/app_dev.php</span><span class="s3">`</span>

<span class="s0">The default </span><span class="s3">`</span><span class="s0">web/app_dev.php</span><span class="s3">` </span><span class="s0">file now reads as follows</span><span class="s1">:</span>

    <span class="s3">&lt;?php</span>

    <span class="s3">use Symfony\Component\HttpFoundation\Request;</span>

    <span class="s3">// If you don't want to setup permissions the proper way, just uncomment the following PHP line</span>
    <span class="s3">// read http://symfony.com/doc/current/book/installation.html#configuration-and-setup for more information</span>
    <span class="s3">//umask(0000);</span>

    <span class="s3">// This check prevents access to debug front controllers that are deployed by accident to production servers.</span>
    <span class="s3">// Feel free to remove this, extend it, or make something more sophisticated.</span>
    <span class="s3">if (isset($_SERVER['HTTP_CLIENT_IP'])</span>
        <span class="s3">|| isset($_SERVER['HTTP_X_FORWARDED_FOR'])</span>
        <span class="s3">|| !in_array(@$_SERVER['REMOTE_ADDR'], array(</span>
            <span class="s3">'127.0.0.1',</span>
            <span class="s3">'::1',</span>
        <span class="s3">))</span>
    <span class="s3">) {</span>
        <span class="s3">header('HTTP/1.0 403 Forbidden');</span>
        <span class="s3">exit('You are not allowed to access this file. Check '.basename(__FILE__).' for more information.');</span>
    <span class="s3">}</span>

    <span class="s3">$loader = require_once __DIR__.'/../app/bootstrap.php.cache';</span>
    <span class="s3">require_once __DIR__.'/../app/AppKernel.php';</span>

    <span class="s3">$kernel = new AppKernel('dev', true);</span>
    <span class="s3">$kernel-&gt;loadClassCache();</span>
    <span class="s3">$request = Request::createFromGlobals();</span>
    <span class="s3">$response = $kernel-&gt;handle($request);</span>
    <span class="s3">$response-&gt;send();</span>
    <span class="s3">$kernel-&gt;terminate($request, $response);</span>
</pre>
</body>
</html>